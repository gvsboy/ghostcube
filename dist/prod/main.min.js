!function e(t,i,n){function s(a,l){if(!i[a]){if(!t[a]){var u="function"==typeof require&&require;if(!l&&u)return u(a,!0);if(r)return r(a,!0);var o=new Error("Cannot find module '"+a+"'");throw o.code="MODULE_NOT_FOUND",o}var d=i[a]={exports:{}};t[a][0].call(d.exports,function(e){var i=t[a][1][e];return s(i?i:e)},d,d.exports,e,t,i,n)}return i[a].exports}for(var r="function"==typeof require&&require,a=0;a<n.length;a++)s(n[a]);return s}({1:[function(e,t,i){"use strict";var n=function(e){return e&&e.__esModule?e:{"default":e}};e("babel/polyfill");{var s=e("./game"),r=n(s);new r["default"]("container")}},{"./game":7,"babel/polyfill":"babel/polyfill"}],2:[function(e,t,i){"use strict";function n(e,t,i,n){u["default"].call(this,e,t,i),this.opponent=n}var s=function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(i,"__esModule",{value:!0});var r=e("lodash"),a=s(r),l=e("./player"),u=s(l);n.THINKING_SPEED=600,n.prototype={play:function(){return this._logText="",this._log("================== BOT MOVE =================="),this._selectLines()||this._selectOpponentLines()||this._selectSingles()||this._selectOpponentSingles()||this.selectRandom(),this._selector.getSelected()},_selectLines:function(e){var t=this,i=e?this.opponent.getLines():this.getLines();return this._log("++++++ LINES"+(e?" OPPONENT:":":"),i),a["default"].some(i,function(e){var i,n=t.getInitialTile(),s=e.missingTiles()[0];return t._log("+++ lines loop [initial, tile] :",n,s),n&&s?(i=t.getAttackTile(n,s),i&&t.selectTile(s,i).success()):void t.selectTile(s)})},_selectOpponentLines:function(){return this._selectLines(!0)},_selectSingles:function(e){var t=this,i=a["default"].shuffle(e?this.opponent.getSingles():this.getSingles());return this._log("------ SINGLES"+(e?" OPPONENT:":":"),i),a["default"].some(i,function(e){var i,n,s=t.getInitialTile();return(!s||e.isNeighboringSide(s))&&(i=t._selectByTileLine(e)),t._log("--- singles loop [initial, tile] :",s,i),s&&i?(n=t.getAttackTile(s,i),t._selector.revert(),n&&t.selectTile(i,n).success()):void 0})},_selectOpponentSingles:function(){return this._selectSingles(!0)},_selectByTileLine:function(e){var t=this,i=a["default"].shuffle(e.getAllLineTiles());return a["default"].find(i,function(e){return t.selectTile(e).success()})},_log:function(){var e=a["default"].reduce(arguments,function(e,t){return e.push(a["default"].isEmpty(t)?"NONE":t.toString()),e},[]).join(" ");this._logText+=e+"\n"}},i["default"]=n,t.exports=i["default"]},{"./player":9,lodash:"lodash"}],3:[function(e,t,i){"use strict";function n(e,t){this.el=e,this.size=t||3,this.style=this.el.style,this._sides=null,this._eventMap={}}var s=function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(i,"__esModule",{value:!0});var r=e("lodash"),a=s(r),l=e("./side"),u=s(l),o=e("../util/vendor"),d=s(o);n.ROTATE_X_PREFIX="rotateX(",n.ROTATE_Y_PREFIX="rotateY(",n.ROTATE_UNIT_SUFFIX="deg)",n.REVOLUTION=360,n.ROTATION_UNIT=90,n.ORIGIN=0,n.prototype={build:function(){var e=this;return this._sides=this._buildSides(this.size),this.x=this.y=n.REVOLUTION-n.ROTATION_UNIT/2,new Promise(function(t){var i=e.el;i.addEventListener(d.events.animationIteration,function(){i.classList.add("transition"),i.addEventListener(d.events.animationEnd,function(e){e.target===i&&(i.classList.remove("transition"),i.classList.add("init"),t())})})})},setRenderer:function(e){this._renderer=e},rotate:function(e,t){this.x=this._calculateCoordinate(this.x,e),this.y=this._calculateCoordinate(this.y,t),this.style[d.js.transform]=n.ROTATE_X_PREFIX+this.x+n.ROTATE_UNIT_SUFFIX+" "+n.ROTATE_Y_PREFIX+this.y+n.ROTATE_UNIT_SUFFIX},rotateToTiles:function(e){var t=this,i=this._getCommonVisibleCoordinates(e),n=this._getShortestRotationDistance(i);return new Promise(function(e){t._renderer.setMovement(n[0],n[1]).then(e)})},listenTo:function(e,t,i){var n=this._eventMap,s=a["default"].bind(t,i||this);return n[e]||(n[e]=[]),this._eventMap[e].push(s),this.el.addEventListener(e,s),this},stopListeningTo:function(e){return a["default"].forEach(this._eventMap[e],function(t){this.el.removeEventListener(e,t)},this),this},getSides:function(e){return e?this._sides[e]:this._sides},getVisibleSides:function(){},getAvailableTiles:function(e){var t=a["default"].reduce(this.getSides(),function(t,i){return e&&i===e.side||t.push(a["default"].shuffle(i.getAvailableTiles())),t},[]);return a["default"].flatten(a["default"].sortBy(t,"length"))},updateCrosshairs:function(e,t){a["default"].forEach(e.getAllLineTiles(),t),a["default"].forEach(e.side.getNeighbors(),function(i){a["default"].forEach(e.translate(i),t)})},getAttackTile:function(e,t){var i,n,s=this;return e&&t&&e.isNeighboringSide(t)?(i=a["default"].without(t.side.getNeighbors(),e.side),n=a["default"].find(i,function(e){return e.isVisible(s.x,s.y)}),a["default"].intersection(e.translate(n),t.translate(n))[0]):null},_calculateCoordinate:function(e,t){var i=n.REVOLUTION,s=e+t;return s>i?s-=i:s<=n.ORIGIN&&(s=i-s),s},_getCommonVisibleCoordinates:function(e){var t=a["default"].map(e,function(e){return e.side._visibilityMap}),i=a["default"].intersection.apply(a["default"],a["default"].map(t,function(e){return a["default"].map(a["default"].keys(e),a["default"].parseInt)})),n=a["default"].flatten(a["default"].map(i,function(e){return a["default"].intersection.apply(a["default"],a["default"].pluck(t,e))}));return a["default"].zip(i,n)},_getShortestCoordinateDiff:function(e,t){var i=n.REVOLUTION,s=t-e;return Math.abs(s)>i/2&&(s=t>e?t-i-e:i-e+t),s},_getShortestRotationDistance:function(e){return a["default"].reduce(e,function(e,t){var i=[this._getShortestCoordinateDiff(this.x,t[0]),this._getShortestCoordinateDiff(this.y,t[1])];return!e||Math.abs(i[0])+Math.abs(i[1])<Math.abs(e[0])+Math.abs(e[1])?i:e},null,this)},_buildSides:function(e){var t=a["default"].reduce(this.el.children,function(t,i){return t[i.id]=new u["default"](i,e),t},{}),i=t.top,n=t.bottom,s=t.front,r=t.back,l=t.left,o=t.right,d={top:[r,s,l,o],bottom:[s,r,l,o],front:[i,n,l,o],back:[n,i,l,o],left:[i,n,r,s],right:[i,n,s,r]},c={front:{315:[45,315],45:[45,315],135:[135,225],225:[135,225]},back:{315:[135,225],45:[135,225],135:[45,315],225:[45,315]},top:{315:[45,135,225,315],225:[45,135,225,315]},bottom:{135:[45,135,225,315],45:[45,135,225,315]},left:{315:[45,135],45:[45,135],135:[225,315],225:[225,315]},right:{315:[225,315],45:[225,315],135:[45,135],225:[45,135]}};return a["default"].forIn(t,function(e){e.setNeighbors(d[e.id]),e.setVisibilityMap(c[e.id])})}},i["default"]=n,t.exports=i["default"]},{"../util/vendor":19,"./side":5,lodash:"lodash"}],4:[function(e,t,i){"use strict";function n(e){this.side=a["default"].first(e).side,this.update(e)}var s=function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(i,"__esModule",{value:!0});var r=e("lodash"),a=s(r);n.prototype={toString:function(){var e=a["default"].reduce(this.getTiles(),function(e,t){return e.push(t.toString()),e},[]);return"("+e.join(" ")+")"},all:function(e){var t=this.getTiles();return a["default"].every(e,function(e){return a["default"].includes(t,e)})},some:function(e){return a["default"].every(this.getTiles(),function(t){return a["default"].includes(e,t)})},update:function(e){this._tiles=e},pulsate:function(){a["default"].forEach(this.getTiles(),function(e){return e.addClass("win")})},isHorizontal:function(){var e=this.getTiles();return a["default"].includes(e[0].xLine.getTiles(),e[1])},getTiles:function(){return this._tiles},length:function(){return this._tiles.length},indicies:function(){return a["default"].map(this.getTiles(),"index")},missingTiles:function(){var e=this.getTiles(),t=this.isHorizontal()?a["default"].first(e).xLine:a["default"].first(e).yLine;return a["default"].xor(e,t.getTiles())},rotate:function(){var e=a["default"].first(this.getTiles()).index;return this.isHorizontal()?this.side.getTiles(e+e/this.length())[0].yLine:this.side.getTiles(e*this.length())[0].xLine},flip:function(){var e,t=a["default"].first(this.getTiles()).index;return this.isHorizontal()?(e=Math.floor(Math.pow(this.length(),2)/2-1),this.side.getTiles(2*e-t)[0].xLine):(e=(this.length()-1)/2,this.side.getTiles(2*e-t)[0].yLine)}},i["default"]=n,t.exports=i["default"]},{lodash:"lodash"}],5:[function(e,t,i){"use strict";function n(e,t){this.el=e,this.id=e.id,this._neighbors={},this._tiles=this._buildTiles(t)}var s=function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(i,"__esModule",{value:!0});var r=e("lodash"),a=s(r),l=e("./tile"),u=s(l),o=e("./line"),d=s(o);n.prototype={getNeighbors:function(){return this._neighbors},setNeighbors:function(e){this._neighbors=e},isNeighbor:function(e){return a["default"].contains(this._neighbors,e)},setVisibilityMap:function(e){this._visibilityMap=e},isVisible:function(e,t){return a["default"].contains(this._visibilityMap[e],t)},getTiles:function(e){return a["default"].isUndefined(e)?this._tiles:a["default"].at(this._tiles,a["default"].isArray(e)?a["default"].uniq(a["default"].flatten(e)):+e)},getAvailableTiles:function(){return a["default"].reject(this._tiles,"claimedBy")},_buildTiles:function(e){var t=this,i=a["default"].times(Math.pow(e,2),function(e){return new u["default"](t,e)}),n={x:a["default"].times(e,function(t){return new d["default"](i.slice(t*e,(t+1)*e))}),y:a["default"].times(e,function(t){var n=a["default"].times(e,function(i){return t+i*e});return new d["default"](a["default"].at(i,n))})};return a["default"].forEach(i,function(t,i){var s=i%e,r=n.x[(i-s)/e],a=n.y[s];t.updateLines(r,a)}),i}},i["default"]=n,t.exports=i["default"]},{"./line":4,"./tile":6,lodash:"lodash"}],6:[function(e,t,i){"use strict";function n(e,t){this.el=this.build(e.id+"-"+t),this.side=e,this.index=t,this.claimedBy=null,this.xLine=null,this.yLine=null,e.el.appendChild(this.el)}var s=function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(i,"__esModule",{value:!0});var r=e("lodash"),a=s(r),l=e("../util/vendor"),u=e("../util/util");n.prototype={toString:function(){return this.el.id},build:function(e){var t=this,i=document.createElement("div");return i.id=e,i.className="tile",window.setTimeout(function(){return t.addClass("init")},2e3*Math.random()),i},claim:function(e){var t=this;this.claimedBy=e,this.removeClass("unclaimed").addClass("preclaimed").addClass(e.tileClass),u.listenOnce(this.el,l.events.animationEnd,function(){t.removeClass("preclaimed").addClass("claimed")})},release:function(){this.claimedBy&&(this.addClass("unclaimed").removeClass("claimed").removeClass(this.claimedBy.tileClass).removeClass("win"),this.claimedBy=null)},isNeighboringSide:function(e){return this.side.isNeighbor(e.side)},addClass:function(e){return this.el.classList.add(e),this},removeClass:function(e){return this.el.classList.remove(e),this},updateLines:function(e,t){this.xLine=e,this.yLine=t},getAllLineTiles:function(){return a["default"].union(this.xLine.getTiles(),this.yLine.getTiles())},translate:function(e){var t=n.translationMap[this.side.id][e?e.id:null],i="x"===a["default"].first(t)?this.xLine:this.yLine;if(t){var s=a["default"].reduce(a["default"].rest(t),function(e,t){return e[t]()},i);return e.getTiles(s.indicies())}return null}},n.translationMap=function(){var e="x",t="y",i="flip",n="rotate";return{front:{top:[t],bottom:[t],left:[e],right:[e]},back:{bottom:[t,i],top:[t,i],left:[e],right:[e]},top:{back:[t,i],front:[t],left:[e,n],right:[e,i,n]},bottom:{front:[t],back:[t,i],left:[e,i,n],right:[e,n]},left:{top:[t,n],bottom:[t,i,n],back:[e],front:[e]},right:{top:[t,i,n],bottom:[t,n],front:[e],back:[e]}}}(),i["default"]=n,t.exports=i["default"]},{"../util/util":18,"../util/vendor":19,lodash:"lodash"}],7:[function(e,t,i){"use strict";function n(e){this.container=document.getElementById(e),this.isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent),this.cube=new u["default"](this.container.querySelector(".cube")),this.messages=new g["default"],this.renderer=new _["default"](this.cube,this.isMobile),this.players=null,this.currentPlayer=null,this._helperTile=null,this.recorder=new m["default"](this),this.idle()}var s=function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(i,"__esModule",{value:!0});var r=e("lodash"),a=s(r),l=e("./cube/cube"),u=s(l),o=e("./player"),d=s(o),c=e("./bot"),h=s(c),f=e("./render/renderer"),_=s(f),p=e("./recorder"),m=s(p),v=e("./messages"),g=s(v),y=e("./tutorial"),b=s(y),T=e("./util/util"),L=e("./util/vendor");n.prototype={idle:function(){var e=this,t=this.container,i=t.querySelector("#hit");T.listenOnce(i,"click",function(){i.style.display="none",t.classList.add("game"),e._initializeTutorial(),T.listenOnce(t,L.events.animationEnd,function(){e.cube.build().then(a["default"].bind(e.initializeGame,e))})})},initializeGame:function(){var e=new d["default"]("Player","player1",this.cube),t=new h["default"]("CPU","player2",this.cube,e);this.players=[e,t],this.renderer.initialize(),this.renderer.on("start",a["default"].bind(this.clearHelperTile,this)),this.setCurrentPlayer(a["default"].first(this.players))},enableCubeInteraction:function(){this.renderer.listenForInput(),this.cube.listenTo("click",this._handleClick,this).listenTo("mouseover",this._handleMouseOver,this).listenTo("mouseout",this._handleMouseOut,this)},disableCubeInteraction:function(){this.renderer.stopListeningForInput(),this.cube.stopListeningTo("click").stopListeningTo("mouseover").stopListeningTo("mouseout")},setCurrentPlayer:function(e,t){this.messages.add(e.name+"'s turn!","alert"),this.currentPlayer!==e&&(this.cube.el.classList.add(e.tileClass+"-turn"),this.currentPlayer&&this.cube.el.classList.remove(this.currentPlayer.tileClass+"-turn"),this.currentPlayer=e,e.hasValidMoves()?e.isBot()?(this.disableCubeInteraction(),t||this._botTileSelection(e.play())):this.enableCubeInteraction():this._stalemate())},getOpponent:function(e){return this.players[1===this.players.indexOf(e)?0:1]},showCrosshairs:function(e){e.addClass("selected"),this.cube.updateCrosshairs(e,function(e){return e.addClass("highlighted")})},hideCrosshairs:function(e){e.removeClass("selected"),this.cube.updateCrosshairs(e,function(e){return e.removeClass("highlighted")})},clearHelperTile:function(){this._helperTile&&this._helperTile.removeClass("helper"),this._helperTile=null},_initializeTutorial:function(){this.tutorial=new b["default"],this.tutorial.hook(this,"initializeGame","start").hook(this,"showCrosshairs","click").hook(this,"_endTurn","turn"),this.messages.listenTo(this.tutorial)},_endTurn:function(e){var t=this.currentPlayer,i=t.getWinLines();this.recorder.record(t,e),this.clearHelperTile(),this.hideCrosshairs(a["default"].first(e)),this._endGame(i)||this.setCurrentPlayer(this.getOpponent(t))},_endGame:function(e){var t,i=e.length;return i?(t=i>1?" x"+i+"!":"!",this.messages.add(""+this.currentPlayer.name+" wins"+t,"alert persist"),a["default"].invoke(e,"pulsate"),this._waitAndListenForReset(),!0):!1},_stalemate:function(){this.messages.add("stalemate","alert persist").add(""+this.currentPlayer.name+" has no valid moves.","persist"),this._waitAndListenForReset()},_waitAndListenForReset:function(){var e=this;this.currentPlayer=null,this.disableCubeInteraction(),setTimeout(function(){e.messages.add("newGame","persist"),T.listenOnce(document,"click",a["default"].bind(e._resetGameState,e))},2e3)},_resetGameState:function(){var e=this;this.messages.removeAll(),this.cube.el.classList.add("reset"),this.renderer.setSyncMovement(450,450).then(function(){a["default"].forEach(e.players,function(e){return e.releaseAll()}),e.cube.el.classList.remove("reset"),e.setCurrentPlayer(a["default"].first(e.players))})},_getTileFromElement:function(e){var t;return e.classList.contains("tile")?(t=e.id.split("-"),this.cube.getSides(t[0]).getTiles(t[1])[0]):null},_botTileSelection:function(e){var t=this,i=function(){return new Promise(function(e){setTimeout(e,h["default"].THINKING_SPEED)})};i().then(function(){return t.cube.rotateToTiles(e)}).then(i).then(function(){return t.showCrosshairs(e[0])}).then(i).then(function(){t.currentPlayer.claimAll(),t._endTurn(e)})},_handleClick:function(e){var t=this,i=this._getTileFromElement(e.target);i&&this.currentPlayer.selectTile(i,this._helperTile).success(function(e){var i=e.selected,n=i&&i.length;e.deselect&&t.hideCrosshairs(e.deselect[0]),1===n?t.showCrosshairs(i[0]):3===n&&(t.currentPlayer.claimAll(),t._endTurn(i))}).failure(function(e){return t.messages.add(e,"error")})},_handleMouseOver:function(e){var t=this._getTileFromElement(e.target),i=this.currentPlayer.getInitialTile();this._helperTile=this.cube.getAttackTile(t,i),this._helperTile&&this._helperTile.addClass("helper")},_handleMouseOut:function(e){this.clearHelperTile()}},i["default"]=n,t.exports=i["default"]},{"./bot":2,"./cube/cube":3,"./messages":8,"./player":9,"./recorder":10,"./render/renderer":12,"./tutorial":17,"./util/util":18,"./util/vendor":19,lodash:"lodash"}],8:[function(e,t,i){"use strict";function n(){this.delay=100,this.queue=[],this.container=this._buildContainer(),this.container.addEventListener(l.events.animationEnd,a["default"].bind(this._remove,this))}var s=function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(i,"__esModule",{value:!0});var r=e("lodash"),a=s(r),l=e("./util/vendor");n.prototype={listenTo:function(e){e.on("message",a["default"].bind(this.add,this))},add:function(e,t){var i=this;return e=a["default"].isArray(e)?e:[e],a["default"].forEach(e,function(e){i._generateItem(n.LIST[e]||e,t)}),this},removeAll:function(){a["default"].forEach(this.container.children,function(e){return e.classList.add("hide")})},_generateItem:function(e,t){var i=document.createElement("li");t&&DOMTokenList.prototype.add.apply(i.classList,t.split(" ")),i.appendChild(document.createTextNode(e)),this._enqueue(i)},_enqueue:function(e){var t=this.container,i=this.queue,n=i.length*this.delay;i.push(e),a["default"].delay(function(n){t.appendChild(e),a["default"].last(i)===n&&(i.length=0)},n,e)},_remove:function(e){var t=e.target.classList;(!t.contains("persist")||t.contains("hide"))&&this.container.removeChild(e.target)},_buildContainer:function(){var e=document.createElement("ul");return e.id="messages",document.body.appendChild(e),e}},n.LIST={claimed:"This tile is already claimed!",targetClaimed:"The attack target is already claimed by you!",cannotAttack:"You cannot attack your own tile!",sameSide:"Same side! Choose a tile on a different side.",notNeighbor:"Not a neighboring side! Choose a tile different side.",stalemate:"Stalemate!",newGame:"Click anywhere to begin a new game."},i["default"]=n,t.exports=i["default"]},{"./util/vendor":19,lodash:"lodash"}],9:[function(e,t,i){"use strict";function n(e,t,i){this.name=e,this.tileClass=t,this._selector=new d["default"](this),this._cubeCache=new h["default"](i)}var s=function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(i,"__esModule",{value:!0});var r=e("lodash"),a=s(r),l=e("./bot"),u=s(l),o=e("./selection/TileSelector"),d=s(o),c=e("./selection/CubeCache"),h=s(c);n.prototype={isBot:function(){return this instanceof u["default"]},claim:function(e){e.claim(this),this._cubeCache.add(e)},release:function(e){this._cubeCache.remove(e),e.release()},releaseAll:function(){a["default"].forEach(this._cubeCache.getAllTiles(),function(e){return e.release()}),this._cubeCache.initialize()},getLines:function(){return this._cubeCache.getLines()},getSingles:function(){return this._cubeCache._singles},getInitialTile:function(){return this._selector.getInitial()},getAttackTile:function(e,t){return this._cubeCache._cube.getAttackTile(e,t)},getWinLines:function(){var e=this._cubeCache._cube.size;return a["default"].filter(this.getLines(),function(t){return t.length()===e})},canAttack:function(e){return e.claimedBy!==this},selectTile:function(e,t){return this._selector.validate(e,t)},claimAll:function(){a["default"].forEach(this._selector._selected,function(e,t,i){e.claimedBy?(i[t]=this._createAttackData(e),e.claimedBy.release(e)):this.claim(e)},this),this._selector.reset()},hasValidMoves:function(){var e=this.selectRandom();return this._selector.reset(),e},selectRandom:function(){var e=this,t=function(t){return a["default"].some(s,function(n){var s=e.getAttackTile(t,n);return s&&i.validate(n,s).success()})},i=this._selector,n=i.getInitial(),s=this._cubeCache._cube.getAvailableTiles(n);return n&&t(n)?!0:a["default"].some(s,function(e){return i.reset(),i.validate(e).success()&&t(e)})},_createAttackData:function(e){return{player:e.claimedBy,tile:e,toString:function(){return"(attack -> "+e.toString()+")"}}}},a["default"].assign(u["default"].prototype,n.prototype),i["default"]=n,t.exports=i["default"]},{"./bot":2,"./selection/CubeCache":14,"./selection/TileSelector":15,lodash:"lodash"}],10:[function(e,t,i){"use strict";function n(e){this._timeline=[],this._cursor=0,this._app=e}var s=function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(i,"__esModule",{value:!0});var r=e("lodash"),a=s(r),l=e("./cube/tile"),u=s(l);n.MESSAGES={NOT_FOUND:"Could not locate a turn at ",REWRITE:"Turns are now being rewritten as the timeline was behind by ",NO_LOG:"[No log for this turn]"},n.prototype={record:function(e,t){var i=this._timeline.length-this._cursor;i&&(console.warn(n.MESSAGES.REWRITE+i),this._timeline=a["default"].dropRight(this._timeline,i)),this._package(e,t),this._cursor++},forward:function(){var e=this._timeline[this._cursor];if(!e)throw n.MESSAGES.NOT_FOUND+this._cursor;a["default"].forEach(e.tiles,function(t){t instanceof u["default"]?e.player.claim(t):t.player.release(t.tile)}),console.log(e.log),this._cursor++,this._app.setCurrentPlayer(this._app.getOpponent(e.player),!0)},reverse:function(){var e=this._timeline[this._cursor-1];if(!e)throw n.MESSAGES.NOT_FOUND+this._cursor;a["default"].forEach(e.tiles,function(t){t instanceof u["default"]?e.player.release(t):t.player.claim(t.tile)}),this._cursor--,this._app.setCurrentPlayer(e.player,!0)},_package:function(e,t){this._timeline.push({player:e,tiles:t,log:e._logText||n.MESSAGES.NO_LOG})}},i["default"]=n,t.exports=i["default"]},{"./cube/tile":6,lodash:"lodash"}],11:[function(e,t,i){"use strict";function n(e,t){this.speed=t,"string"==typeof e&&(e=e.split(" ")),this.keys=a["default"].reduce(e,function(e,t){return e[t]=!1,e},{})}var s=function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(i,"__esModule",{value:!0});var r=e("lodash"),a=s(r);n.prototype={listen:function(e){var t=this,i=void 0===arguments[1]?window:arguments[1],n=function(i){return a["default"].bind(a["default"].partialRight(i,e),t)};this._boundHandleKeydown=n(this._handleKeydown),this._boundHandleKeyup=n(this._handleKeyup),i.addEventListener("keydown",this._boundHandleKeydown),i.addEventListener("keyup",this._boundHandleKeyup)},stopListening:function(){var e=void 0===arguments[0]?window:arguments[0];e.removeEventListener("keydown",this._boundHandleKeydown),e.removeEventListener("keyup",this._boundHandleKeyup)},getMovement:function(){var e=n,t=this.keys,i=0,s=0;return t[e.UP]||t[e.W]?i=this.speed:(t[e.DOWN]||t[e.S])&&(i=-this.speed),t[e.LEFT]||t[e.A]?s=this.speed:(t[e.RIGHT]||t[e.D])&&(s=-this.speed),{x:i,y:s}},_handleKeydown:function(e,t){var i=e.keyCode,n=this.keys;a["default"].isUndefined(n[i])||n[i]||(n[i]=!0,t&&t())},_handleKeyup:function(e,t){var i=e.keyCode;this.keys[i]&&(this.keys[i]=!1,t&&t())}},n.UP="38",n.DOWN="40",n.LEFT="37",n.RIGHT="39",n.W="87",n.A="65",n.S="83",n.D="68",n.SPACE="32",n.ESCAPE="27",i["default"]=n,t.exports=i["default"]},{lodash:"lodash"}],12:[function(e,t,i){"use strict";function n(e,t){this.cube=e,this.keyboard=null,this.touch=null,this.moveX=0,this.moveY=0,this.tickMax=90,this.tick=0,this.speed=5,this.isMobile=t}var s=function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(i,"__esModule",{value:!0});var r=e("lodash"),a=s(r),l=e("events"),u=e("./keyboard"),o=s(u),d=e("./touch"),c=s(d);n.prototype={initialize:function(){this._input=this.isMobile?new c["default"](this.speed):new o["default"]([o["default"].UP,o["default"].DOWN,o["default"].LEFT,o["default"].RIGHT,o["default"].W,o["default"].A,o["default"].S,o["default"].D],this.speed),this.cube.setRenderer(this)},listenForInput:function(){this._input.listen(this._movementListener.bind(this))},stopListeningForInput:function(){this._input.stopListening()},draw:function(){this.tick-=this.speed,this.cube.rotate(this.moveX,this.moveY),this.tick>0||this._setMovementFromInput()?this._loop():this.emit("end")},setMovement:function(e,t){var i=this,n=function(e,t){i.tick=Math.abs(e),i[t]=e?0>e?-i.speed:i.speed:0,i._loop()};return new Promise(function(s){n(e,"moveX"),i.once("end",function(){n(t,"moveY"),i.once("end",s)})})},setSyncMovement:function(){var e=this,t=void 0===arguments[0]?0:arguments[0],i=void 0===arguments[1]?0:arguments[1],n=this.speed;return new Promise(function(s){e.tick=Math.max(t,i),e.moveX=0===t?0:0>t?-n:n,e.moveY=0===i?0:0>i?-n:n,e._loop(),e.once("end",s)})},_loop:function(){window.requestAnimationFrame(this.draw.bind(this))},_movementListener:function(){this.tick<=0&&this._setMovementFromInput()&&(this._loop(),this.emit("start"))},_setMovementFromInput:function(){var e=this._input.getMovement();return this.moveX=e.x,this.moveY=e.y,0!==this.moveX||0!==this.moveY?(this.tick=this.tickMax,!0):!1}},a["default"].assign(n.prototype,l.EventEmitter.prototype),i["default"]=n,t.exports=i["default"]},{"./keyboard":11,"./touch":13,events:"events",lodash:"lodash"}],13:[function(e,t,i){"use strict";function n(e){this.speed=e,this.queue=[],this.iface=new u["default"](document.body),this.iface.get("swipe").set({direction:u["default"].DIRECTION_ALL,threshold:.1,velocity:.1})}var s=function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(i,"__esModule",{value:!0});var r=e("lodash"),a=s(r),l=e("hammerjs"),u=s(l);n.prototype={listen:function(e){this._boundHandleSwipe=a["default"].bind(a["default"].partialRight(this._handleSwipe,e),this),this.iface.on("swipe",this._boundHandleSwipe)},stopListening:function(){this.iface.off("swipe",this._boundHandleSwipe)},getMovement:function(){var e=this.queue.shift(),t=0,i=0;switch(e){case n.UP:t=-this.speed;break;case n.DOWN:t=this.speed;break;case n.LEFT:i=this.speed;break;case n.RIGHT:i=-this.speed}return{x:t,y:i}},_handleSwipe:function(e,t){this.queue.push(e.offsetDirection),t&&t()}},n.UP=u["default"].DIRECTION_UP,n.DOWN=u["default"].DIRECTION_DOWN,n.LEFT=u["default"].DIRECTION_LEFT,n.RIGHT=u["default"].DIRECTION_RIGHT,i["default"]=n,t.exports=i["default"]},{hammerjs:"hammerjs",lodash:"lodash"}],14:[function(e,t,i){"use strict";function n(e){this._cube=e,this.initialize()}var s=function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(i,"__esModule",{value:!0});var r=e("lodash"),a=s(r),l=e("../cube/line"),u=s(l);n.prototype={initialize:function(){this._lineMap=a["default"].reduce(this._cube.getSides(),function(e,t,i){return e[i]=[],e},{}),this._singles=[]},add:function(e){var t=e.claimedBy,i=this._getPartialLineTiles(e.xLine,t),n=this._getPartialLineTiles(e.yLine,t),s=this._growLine(i),r=this._growLine(n);s||r?this._singles=a["default"].difference(this._singles,e.getAllLineTiles()):this._singles.push(e)},remove:function(e){var t,i,n=e.claimedBy,s=this._getPartialLineTiles(e.xLine,n),r=this._getPartialLineTiles(e.yLine,n);a["default"].pull(s,e),a["default"].pull(r,e),t=this._shrinkLine(s,!0),i=this._shrinkLine(r,!1),t||i?(t&&!this._composesLines(s)&&(this._singles=a["default"].union(this._singles,s)),i&&!this._composesLines(r)&&(this._singles=a["default"].union(this._singles,r))):a["default"].pull(this._singles,e)},getLines:function(){return this._getLinesAsChain().sortBy(function(e){return e._tiles.length}).value()},getAllTiles:function(){return this._getLinesAsChain().map(function(e){return e.getTiles()}).flatten().uniq().concat(this._singles).value()},_getLinesAsChain:function(){return a["default"].chain(this._lineMap).values().flatten().compact()},_getPartialLineTiles:function(e,t){return a["default"].filter(e.getTiles(),function(e){return e.claimedBy===t})},_growLine:function(e){var t,i;return e.length>1?(t=this._lineMap[a["default"].first(e).side.id],i=a["default"].find(t,function(t){return t.some(e)}),i?i.update(e):t.push(new u["default"](e)),!0):!1},_shrinkLine:function(e,t){var i,n;if(e.length&&(i=this._lineMap[a["default"].first(e).side.id],n=a["default"].find(i,function(i){return i.isHorizontal()===t&&i.all(e)}))){if(1===e.length)return a["default"].pull(i,n),!0;n.update(e)}return!1},_composesLines:function(e){var t=this._lineMap[a["default"].first(e).side.id];return a["default"].find(t,function(t){return t.all(e)})}},i["default"]=n,t.exports=i["default"]},{"../cube/line":4,lodash:"lodash"}],15:[function(e,t,i){"use strict";var n=function(e){return e&&e.__esModule?e:{"default":e}},s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();Object.defineProperty(i,"__esModule",{value:!0});var a=e("lodash"),l=n(a),u=e("./TileSelectorResult"),o=n(u),d=function(){function e(t){s(this,e),this._player=t,this.reset()}return r(e,[{key:"reset",value:function(){this._selected=[]}},{key:"revert",value:function(){var e=void 0===arguments[0]?1:arguments[0],t=l["default"].dropRight(this._selected,e);return this._selected=t,t}},{key:"getSelected",value:function(){return this._selected}},{key:"getInitial",value:function(){return l["default"].first(this._selected)}},{key:"validate",value:function(e,t){var i=this.getInitial(),n={};if(!e)return o["default"].failure();if(e.claimedBy)return o["default"].failure(o["default"].FAILURE_CLAIMED);if(i){if(e===i)return o["default"].success(this._deselect(e));if(e.side===i.side)n=this._deselect(i);else if(!i.isNeighboringSide(e))return o["default"].failure(o["default"].FAILURE_NOT_NEIGHBOR)}return t?this._player.canAttack(t)?o["default"].success(l["default"].merge(n,this._select(e,t))):o["default"].failure(o["default"].FAILURE_CANNOT_ATTACK):o["default"].success(l["default"].merge(n,this._select(e)))}},{key:"_select",value:function(){var e=l["default"].toArray(arguments);return Array.prototype.push.apply(this._selected,e),{selected:this._selected}}},{key:"_deselect",value:function(e){return l["default"].pull(this._selected,e),{deselect:[e]}}}]),e}();i["default"]=d,t.exports=i["default"]},{"./TileSelectorResult":16,lodash:"lodash"}],16:[function(e,t,i){"use strict";var n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(t,i){n(this,e),this._success=t,this._data=i}return s(e,[{key:"success",value:function(e){return e?(this._success&&e(this._data),this):this._success}},{key:"failure",value:function(e){return e?(this._success||e(this._data),this):!this._success}}],[{key:"success",value:function(t){return new e(!0,t)}},{key:"failure",value:function(t){return new e(!1,t)}}]),e}();r.FAILURE_CLAIMED="claimed",r.FAILURE_NOT_NEIGHBOR="notNeighbor",r.FAILURE_CANNOT_ATTACK="cannotAttack",i["default"]=r,t.exports=i["default"]},{}],17:[function(e,t,i){"use strict";function n(){}var s=function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(i,"__esModule",{value:!0});var r=e("lodash"),a=s(r),l=e("events");n.prototype={hook:function(e,t,i){var s=e[t];return e[t]=a["default"].bind(function(){var r=s.apply(e,arguments);return this.emit("message",n.lessons[i]),e[t]=s,r},this),this}},a["default"].assign(n.prototype,l.EventEmitter.prototype),n.stepMessages=["Let's play! Click any tile to begin.","Rotate the cube using the arrow keys or WASD.","Great! Now, click a tile on an adjacent side.","Nice! A third tile was selected automatically for you.","Try to make a line on one side."],
n.lessons={start:["Let's play! Click any tile to begin.","Rotate the cube using the arrow keys or WASD."],click:"Great! Now, click a tile on an adjacent side.",turn:["Nice! A third tile was selected automatically for you.","Try to make a line on one side!"]},i["default"]=n,t.exports=i["default"]},{events:"events",lodash:"lodash"}],18:[function(e,t,i){"use strict";function n(e,t,i){var n=function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(s){e.removeEventListener(t,n),i(s)});e.addEventListener(t,n)}Object.defineProperty(i,"__esModule",{value:!0}),i.listenOnce=n},{}],19:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});for(var n,s,r,a=document.body.style,l="Transform",u=["ms","O","Moz","Webkit"],o={animation:["animationstart","animationiteration","animationend"],"-o-animation":["oAnimationStart","oAnimationIteration","oAnimationEnd"],"-moz-animation":["animationstart","animationiteration","animationend"],"-webkit-animation":["webkitAnimationStart","webkitAnimationIteration","webkitAnimationEnd"]},d=u.length,c={},h={},f={};d--;)if(u[d]+l in a){n=u[d];break}n||(n=l.toLowerCase()),c.transform=n+l,h.transform=n?"-"+n.toLowerCase()+"-transform":"transform";for(s in o)if("undefined"!=typeof a[s]){r=o[s],f.animationStart=r[0],f.animationIteration=r[1],f.animationEnd=r[2];break}window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,i.js=c,i.css=h,i.events=f},{}]},{},[1]);
//# sourceMappingURL=main.min.js.map